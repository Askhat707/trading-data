<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- üî• –ë–ê–ó–û–í–´–ô –ü–£–¢–¨ –î–õ–Ø GITHUB PAGES -->
    <base href="/trading-data/">
    
    <!-- üî• –ö–≠–®–ò–†–û–í–ê–ù–ò–ï –ò –ú–ï–¢–ê-–¢–ï–ì–ò -->
    <meta http-equiv="Cache-Control" content="public, max-age=3600, must-revalidate">
    <meta http-equiv="Pragma" content="public">
    <meta name="description" content="Gold Options Pro v2 - Professional Trading Terminal for CME Gold Options analytics">
    <meta name="keywords" content="trading, options, gold, CME, analytics, terminal, firebase">
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ö°</text></svg>">
    <title>üèÜ Gold Options Pro v2 - Professional Trading Terminal</title>
    
    <!-- –°–¢–ò–õ–ò -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components/cards.css">
    <link rel="stylesheet" href="css/components/modal.css">
    <link rel="stylesheet" href="css/components/table.css">
    <link rel="stylesheet" href="css/pages/terminal.css">
    
    <!-- FIREBASE SDK (–ó–ê–ì–†–£–ñ–ê–ï–ú –ü–ï–†–í–´–ú–ò!) -->
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database-compat.js"></script>
</head>
<body>
    <!-- –õ–û–ê–î–ï–† -->
    <div id="loading" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #050505; display: flex; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s ease;">
        <div style="text-align: center; max-width: 400px; padding: 30px;">
            <div style="font-size: 4rem; margin-bottom: 20px; color: #FFD700;">‚ö°</div>
            <div style="color: #FFD700; font-size: 2rem; font-weight: 800; margin-bottom: 20px; letter-spacing: 2px;">
                GOLD OPTIONS PRO v2
            </div>
            <div style="color: #888; font-size: 1rem; margin-bottom: 30px;">
                –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞...
            </div>
            <div style="width: 300px; height: 4px; background: rgba(255,215,0,0.2); border-radius: 2px; overflow: hidden; margin: 0 auto 30px;">
                <div id="loading-bar" style="height: 100%; background: #FFD700; width: 5%; transition: width 0.3s ease;"></div>
            </div>
            <div id="loading-status" style="color: #666; font-size: 0.85rem;">
                üöÄ –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã...
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò -->
    <div id="auth-modal" class="auth-modal hidden">
        <div class="auth-container">
            <div class="auth-header">
                <div class="auth-logo">GOLD OPTIONS PRO</div>
                <div class="auth-subtitle">Professional Trading Terminal</div>
            </div>
            
            <div id="auth-error" class="auth-error"></div>
            
            <form id="auth-form" class="auth-form" onsubmit="return handleLogin(event);">
                <div class="form-group">
                    <label class="form-label" for="user-email">Email</label>
                    <input type="email" id="user-email" class="form-input" placeholder="your@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="user-password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="user-password" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                
                <button type="submit" class="auth-button" id="login-btn">
                    –í–û–ô–¢–ò –í –°–ò–°–¢–ï–ú–£
                </button>
            </form>
            
            <div class="auth-footer">
                <div style="margin-bottom: 15px; color: #666; font-size: 0.8rem;">
                    üîê –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                </div>
                <button id="logout-btn" class="auth-button secondary" onclick="handleLogout()" style="display: none; width: 100%;">
                    –í–´–ô–¢–ò –ò–ó –°–ò–°–¢–ï–ú–´
                </button>
            </div>
        </div>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ (—Å–∫—Ä—ã—Ç –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è) -->
    <div id="main-content" style="display: none; opacity: 0; transition: opacity 0.5s ease;">
        <!-- –®–ê–ü–ö–ê –¢–ï–†–ú–ò–ù–ê–õ–ê -->
        <header>
            <div class="logo">
                <span>‚ö°</span> GOLD OPTIONS PRO v2
            </div>
            
            <nav>
                <a href="#" class="active">üìä –¢–µ—Ä–º–∏–Ω–∞–ª</a>
                <a href="#" onclick="showAboutModal(); return false;">‚ÑπÔ∏è –û –ø—Ä–æ–≥—Ä–∞–º–º–µ</a>
                <a href="#" onclick="showTermsModal(); return false;">üìú –£—Å–ª–æ–≤–∏—è</a>
                <a href="#" onclick="showPrivacyModal(); return false;">üîí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a>
                <a href="https://t.me/ASKHAT_1985" target="_blank" class="btn-telegram">üì± Telegram</a>
            </nav>
            
            <div class="user-menu">
                <div class="user-badge" id="user-badge">
                    <span>üë§</span>
                    <span id="user-display">–ì–æ—Å—Ç—å</span>
                </div>
                <button id="header-logout" class="logout-btn" onclick="handleLogout()" style="display: none;">
                    –í—ã–π—Ç–∏
                </button>
            </div>
        </header>

        <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† -->
        <div class="container">
            <h1 class="main-title">GOLD OPTIONS ANALYTICS TERMINAL</h1>
            
            <!-- –°–¢–ê–¢–£–° –ü–ê–ù–ï–õ–¨ -->
            <div class="status-bar">
                <div class="connection-status" id="connStatus">
                    <span style="color:#666">üîÑ INITIALIZING...</span>
                </div>
                
                <div class="data-grid">
                    <div class="data-box">
                        <div class="data-label">CURRENT PRICE</div>
                        <div class="data-value price" id="price">$---</div>
                    </div>
                    <div class="data-box">
                        <div class="data-label">MAX PAIN</div>
                        <div class="data-value" id="mp">$---</div>
                    </div>
                    <div class="data-box">
                        <div class="data-label">EXPECTED MOVE</div>
                        <div class="data-value" id="em">¬±$---</div>
                    </div>
                    <div class="data-box">
                        <div class="data-label">ZERO GAMMA</div>
                        <div class="data-value" id="zg">$---</div>
                    </div>
                    <div class="data-box">
                        <div class="data-label">CALL/PUT RATIO</div>
                        <div class="data-value" id="cp-ratio">--</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px; color: #666; font-size: 0.85rem;">
                    Last Updated: <span id="updated">--:--:--</span>
                </div>
            </div>

            <!-- –ö–ê–†–¢–û–ß–ö–ò –ê–ù–ê–õ–ò–¢–ò–ö–ò -->
            <h2 class="section-header">üìä –û–ü–¶–ò–û–ù–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê</h2>
            <div class="grid-8" id="analytics-cards">
                <div style="text-align: center; color: #666; padding: 40px;">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫...</div>
            </div>

            <!-- –ì–†–ê–§–ò–ö–ò -->
            <h2 class="section-header">üìà –í–ò–ó–£–ê–õ–¨–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê</h2>
            <div class="chart-grid-8" id="charts-container">
                <div style="text-align: center; color: #666; padding: 40px;">–ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤...</div>
            </div>

            <!-- –¢–ê–ë–õ–ò–¶–ê –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
            <div class="main-table-container" id="table-container">
                <div style="text-align: center; color: #666; padding: 40px; width: 100%;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü—ã...</div>
            </div>

            <!-- –ö–û–ù–¢–†–û–õ–¨–ù–ê–Ø –ü–ê–ù–ï–õ–¨ -->
            <div class="bottom-control-panel">
                <div class="bottom-control-grid">
                    <div class="bottom-control-section">
                        <div class="bottom-control-title">üìÖ EXPIRATION SELECTION</div>
                        <div class="control-row">
                            <div id="dte-buttons" style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <span style="color: #666;">Loading expirations...</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bottom-control-section">
                        <div class="bottom-control-title">‚öôÔ∏è DISPLAY SETTINGS</div>
                        <div class="control-row">
                            <div class="control-group">
                                <span class="control-label">Show Premiums:</span>
                                <button id="btn-prem" class="btn" onclick="app.togglePremium()">OFF</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bottom-control-section">
                        <div class="bottom-control-title">üîß SYSTEM TOOLS</div>
                        <div class="control-row">
                            <button class="btn" onclick="CacheControl.clearAllCaches()">üßπ Clear Cache</button>
                            <button class="btn" onclick="window.location.reload(true)">üîÑ Reload Page</button>
                            <button class="btn" onclick="clearServiceWorkerAndReload()">üóëÔ∏è Clear SW</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <!-- üî• –ù–ê–®–ò –ú–û–î–£–õ–ò –í –ü–†–ê–í–ò–õ–¨–ù–û–ú –ü–û–†–Ø–î–ö–ï -->
    <script src="js/constants.js"></script>
    <script src="js/services/cache.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/cache-control.js"></script>
    <script src="js/modules/firebase.js"></script>
    <script src="js/modules/auth.js"></script>
    <script src="js/services/api.js"></script>
    <script src="js/modules/charts.js"></script>
    <script src="js/modules/mt5.js"></script>
    <script src="js/app.js"></script>

    <!-- üî• –û–°–ù–û–í–ù–û–ô –°–ö–†–ò–ü–¢ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–ò -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∫—ç—à–∞
        window.clearServiceWorkerAndReload = function() {
            console.log('üßπ –û—á–∏—Å—Ç–∫–∞ Service Worker –∏ –∫—ç—à–∞...');
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ Service Workers
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    registrations.forEach(registration => {
                        console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º Service Worker:', registration.scope);
                        registration.unregister();
                    });
                });
            }
            
            // –û—á–∏—â–∞–µ–º –∫—ç—à–∏ –±—Ä–∞—É–∑–µ—Ä–∞
            if ('caches' in window) {
                caches.keys().then(cacheNames => {
                    cacheNames.forEach(cacheName => {
                        console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º –∫—ç—à:', cacheName);
                        caches.delete(cacheName);
                    });
                });
            }
            
            // –û—á–∏—â–∞–µ–º localStorage (–∫—Ä–æ–º–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
            const keepKeys = ['gold_options_auth_v7'];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (!keepKeys.includes(key)) {
                    localStorage.removeItem(key);
                }
            }
            
            // –û—á–∏—â–∞–µ–º sessionStorage
            sessionStorage.clear();
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
            setTimeout(() => {
                location.reload(true);
            }, 1000);
        };
        
        window.updateLoadingStatus = function(message, progress) {
            const statusEl = document.getElementById('loading-status');
            const barEl = document.getElementById('loading-bar');
            
            console.log(`üìä [LOADING] ${message} (${progress}%)`);
            
            if (statusEl) statusEl.textContent = message;
            if (barEl && progress !== undefined) {
                barEl.style.width = Math.min(progress, 100) + '%';
            }
        };
        
        window.showErrorScreen = function(message) {
            const loading = document.getElementById('loading');
            if (!loading) return;
            
            loading.innerHTML = `
                <div style="text-align: center; max-width: 600px; padding: 40px;">
                    <div style="font-size: 4rem; color: #ff4444; margin-bottom: 20px;">üî•</div>
                    <h2 style="color: #ff4444; margin-bottom: 15px;">–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê</h2>
                    <div style="background: rgba(255,68,68,0.1); padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px solid #ff4444;">
                        <p style="color: #ccc; margin: 0; line-height: 1.6; font-size: 1rem;">
                            <strong style="color: #ff8888;">${message}</strong>
                        </p>
                    </div>
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                        <button onclick="location.reload(true)" 
                                style="padding: 12px 24px; background: #FFD700; color: #000; border: none; border-radius: 8px; cursor: pointer; font-weight: 800; font-size: 1rem;">
                            üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
                        </button>
                        <button onclick="clearServiceWorkerAndReload()" 
                                style="padding: 12px 24px; background: #333; color: #fff; border: 1px solid #666; border-radius: 8px; cursor: pointer; font-weight: 800; font-size: 1rem;">
                            üßπ –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å
                        </button>
                    </div>
                </div>
            `;
            loading.style.display = 'flex';
            loading.style.opacity = '1';
        };

        (function() {
            'use strict';
            
            console.log('üöÄ [MAIN] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã...');
            
            // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            window.appState = {
                initialized: false,
                configLoaded: false,
                firebaseInitialized: false,
                authInitialized: false,
                error: null
            };
            
            // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Firebase
            function loadFirebaseConfig() {
                return new Promise((resolve, reject) => {
                    console.log('üî• [CONFIG] –ó–∞–≥—Ä—É–∑–∫–∞ firebase-config.js...');
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–π –ø—É—Ç—å
                    const isGitHubPages = window.location.hostname.includes('github.io');
                    const basePath = isGitHubPages ? '/trading-data/' : '/';
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
                    const timestamp = Date.now();
                    const configUrl = basePath + 'firebase-config.js?t=' + timestamp;
                    
                    console.log('üì° [CONFIG] URL:', configUrl);
                    
                    const script = document.createElement('script');
                    script.id = 'firebase-config-loader';
                    script.src = configUrl;
                    script.async = false;
                    
                    // –¢–∞–π–º–∞—É—Ç 15 —Å–µ–∫—É–Ω–¥
                    const timeoutId = setTimeout(() => {
                        reject(new Error('–¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥–∞ (15 —Å–µ–∫—É–Ω–¥)'));
                        script.remove();
                    }, 15000);
                    
                    script.onload = function() {
                        clearTimeout(timeoutId);
                        console.log('‚úÖ [CONFIG] –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
                        
                        // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞
                        setTimeout(() => {
                            if (window.firebaseConfig && window.firebaseConfig.apiKey) {
                                console.log('‚úÖ [CONFIG] –ö–æ–Ω—Ñ–∏–≥ –≥–æ—Ç–æ–≤:', window.firebaseConfig.projectId);
                                window.appState.configLoaded = true;
                                resolve(true);
                            } else {
                                reject(new Error('–ö–æ–Ω—Ñ–∏–≥ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç apiKey'));
                            }
                        }, 100);
                    };
                    
                    script.onerror = function(error) {
                        clearTimeout(timeoutId);
                        console.error('‚ùå [CONFIG] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                        reject(new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${configUrl}`));
                    };
                    
                    document.head.appendChild(script);
                });
            }
            
            // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase
            function initializeFirebase() {
                return new Promise((resolve, reject) => {
                    console.log('üî• [FIREBASE] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥
                    if (!window.firebaseConfig || !window.firebaseConfig.apiKey) {
                        reject(new Error('Firebase –∫–æ–Ω—Ñ–∏–≥ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω'));
                        return;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º Firebase SDK
                    if (typeof firebase === 'undefined') {
                        reject(new Error('Firebase SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω'));
                        return;
                    }
                    
                    try {
                        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
                        if (firebase.apps.length === 0) {
                            firebase.initializeApp(window.firebaseConfig);
                            console.log('‚úÖ [FIREBASE] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
                        } else {
                            console.log('‚úÖ [FIREBASE] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
                        }
                        
                        window.appState.firebaseInitialized = true;
                        resolve(true);
                    } catch (error) {
                        console.error('‚ùå [FIREBASE] –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                        reject(error);
                    }
                });
            }
            
            // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            async function initializeSystem() {
                console.group('üöÄ [INIT] –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...');
                
                try {
                    // –®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞
                    window.updateLoadingStatus('üì¶ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...', 20);
                    await loadFirebaseConfig();
                    
                    // –®–∞–≥ 2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
                    window.updateLoadingStatus('üî• –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase...', 40);
                    await initializeFirebase();
                    
                    // –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π
                    window.updateLoadingStatus('üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π...', 60);
                    
                    if (!window.FirebaseModule) {
                        throw new Error('FirebaseModule –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }
                    
                    if (!window.AuthModule) {
                        throw new Error('AuthModule –Ω–µ –Ω–∞–π–¥–µ–Ω');
                    }
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º FirebaseModule
                    if (!window.FirebaseModule.init()) {
                        throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å FirebaseModule');
                    }
                    
                    // –®–∞–≥ 4: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Auth —Å persistence
                    window.updateLoadingStatus('üîê –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏...', 80);
                    
                    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º persistence –î–û –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                    if (firebase.auth) {
                        await firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);
                        console.log('‚úÖ [AUTH] Persistence —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ LOCAL');
                    }
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º AuthModule
                    await window.AuthModule.autoInit();
                    
                    // –®–∞–≥ 5: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
                    window.updateLoadingStatus('‚öôÔ∏è –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker...', 90);
                    if ('serviceWorker' in navigator) {
                        try {
                            const registration = await navigator.serviceWorker.register('/trading-data/service-worker.js', {
                                scope: '/trading-data/'
                            });
                            console.log('‚úÖ [SW] Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
                        } catch (swError) {
                            console.warn('‚ö†Ô∏è [SW] –û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', swError);
                        }
                    }
                    
                    // –®–∞–≥ 6: –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                    window.updateLoadingStatus('üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...', 95);
                    
                    if (!window.app || typeof window.app.init !== 'function') {
                        throw new Error('–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
                    }
                    
                    await window.app.init();
                    
                    // –®–∞–≥ 7: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
                    window.updateLoadingStatus('‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞!', 100);
                    
                    // –ü–ª–∞–≤–Ω–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –ª–æ–∞–¥–µ—Ä–∞ –∏ –ø–æ–∫–∞–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                    setTimeout(() => {
                        const loading = document.getElementById('loading');
                        if (loading) {
                            loading.style.opacity = '0';
                            loading.style.pointerEvents = 'none';
                            setTimeout(() => {
                                loading.style.display = 'none';
                            }, 500);
                        }
                        
                        const mainContent = document.getElementById('main-content');
                        if (mainContent) {
                            mainContent.style.display = 'block';
                            setTimeout(() => {
                                mainContent.style.opacity = '1';
                            }, 50);
                        }
                    }, 500);
                    
                    window.appState.initialized = true;
                    console.log('‚úÖ [INIT] –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                    
                } catch (error) {
                    console.error('‚ùå [INIT] –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                    window.appState.error = error.message;
                    window.showErrorScreen(error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏');
                }
                
                console.groupEnd();
            }
            
            // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
            function startInitialization() {
                console.log('üöÄ [MAIN] –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã...');
                
                // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ DOM
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => {
                        console.log('üìÑ [DOM] DOMContentLoaded');
                        setTimeout(() => initializeSystem(), 100);
                    });
                } else {
                    console.log('üìÑ [DOM] DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    setTimeout(() => initializeSystem(), 100);
                }
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
            startInitialization();
            
        })();
    </script>
</body>
</html>
