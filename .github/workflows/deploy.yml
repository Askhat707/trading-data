name: üöÄ Deploy Trading Data Terminal

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    # –í–ê–ñ–ù–û: –î–æ–±–∞–≤–ª—è–µ–º environment –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ GitHub Pages
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: üì• –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v4

      - name: üü¢ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: üîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è firebase-config.js –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤
        id: generate-config
        env:
          # –í–ê–ñ–ù–û: –í—Å–µ 8 —Å–µ–∫—Ä–µ—Ç–æ–≤ –î–û–õ–ñ–ù–´ –±—ã—Ç—å –∑–¥–µ—Å—å
          FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
          FIREBASE_AUTH_DOMAIN: ${{ secrets.FIREBASE_AUTH_DOMAIN }}
          FIREBASE_DATABASE_URL: ${{ secrets.FIREBASE_DATABASE_URL }}
          FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
          FIREBASE_STORAGE_BUCKET: ${{ secrets.FIREBASE_STORAGE_BUCKET }}
          FIREBASE_MESSAGING_SENDER_ID: ${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}
          FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}
          FIREBASE_MEASUREMENT_ID: ${{ secrets.FIREBASE_MEASUREMENT_ID }}
        run: |
          echo "üöÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è firebase-config.js..."
          
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤
          echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤:"
          echo "- FIREBASE_API_KEY: ${FIREBASE_API_KEY:0:10}..."
          echo "- FIREBASE_PROJECT_ID: $FIREBASE_PROJECT_ID"
          
          # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç
          node scripts/generate-config.js
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª
          if [ ! -f "firebase-config.js" ]; then
            echo "‚ùå firebase-config.js –Ω–µ —Å–æ–∑–¥–∞–Ω!"
            exit 1
          fi
          
          echo "‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω. –†–∞–∑–º–µ—Ä: $(wc -c < firebase-config.js) –±–∞–π—Ç"

      - name: üìÑ –°–æ–∑–¥–∞–Ω–∏–µ .nojekyll
        run: touch .nojekyll

      - name: üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤
        run: |
          echo "üìÅ –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤:"
          ls -la | grep -E "(firebase|index|\.nojekyll)"
          echo ""
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º firebase-config.js:"
          if [ -f "firebase-config.js" ]; then
            echo "‚úÖ –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
          else
            echo "‚ùå –§–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç!"
            exit 1
          fi

      - name: üì¶ –£–ø–∞–∫–æ–≤–∫–∞ –¥–ª—è GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: .

      - name: üöÄ –î–µ–ø–ª–æ–π –Ω–∞ GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
