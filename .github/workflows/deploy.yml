name: Deploy Trading Data Terminal

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      # ============ Ğ¡ĞĞœĞ«Ğ™ Ğ’ĞĞ–ĞĞ«Ğ™ Ğ¨ĞĞ“! ============
      # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ firebase-config.js Ğ¸Ğ· GitHub Secrets
      # ĞšĞ›Ğ®Ğ§Ğ˜ ĞĞ˜ĞšĞĞ“Ğ”Ğ ĞĞ• Ğ’Ğ˜Ğ”ĞĞ« Ğ’ Ğ Ğ•ĞŸĞĞ—Ğ˜Ğ¢ĞĞ Ğ˜Ğ˜!
      - name: ğŸ” Generate firebase-config.js from GitHub Secrets
        run: |
          mkdir -p _site
          
          cat > _site/firebase-config.js << 'FIREBASE_EOF'
          // ğŸ”¥ FIREBASE CONFIG - Ğ¡Ğ“Ğ•ĞĞ•Ğ Ğ˜Ğ ĞĞ’ĞĞ Ğ˜Ğ— GITHUB SECRETS
          // âš ï¸ ĞšĞ›Ğ®Ğ§Ğ˜ Ğ—ĞĞ©Ğ˜Ğ©Ğ•ĞĞ« Ğ˜ ĞĞ˜ĞšĞĞ“Ğ”Ğ ĞĞ• ĞŸĞĞŸĞĞ”ĞĞ®Ğ¢ Ğ’ Ğ Ğ•ĞŸĞĞ—Ğ˜Ğ¢ĞĞ Ğ˜Ğ™!
          // ğŸ” Ğ¢ĞĞ›Ğ¬ĞšĞ GITHUB Ğ˜ GITHUB PAGES Ğ’Ğ˜Ğ”Ğ¯Ğ¢ Ğ Ğ•ĞĞ›Ğ¬ĞĞ«Ğ• Ğ—ĞĞĞ§Ğ•ĞĞ˜Ğ¯
          
          const firebaseConfig = {
            apiKey: "${{ secrets.FIREBASE_API_KEY }}",
            authDomain: "${{ secrets.FIREBASE_AUTH_DOMAIN }}",
            databaseURL: "${{ secrets.FIREBASE_DATABASE_URL }}",
            projectId: "${{ secrets.FIREBASE_PROJECT_ID }}",
            storageBucket: "${{ secrets.FIREBASE_STORAGE_BUCKET }}",
            messagingSenderId: "${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}",
            appId: "${{ secrets.FIREBASE_APP_ID }}",
            measurementId: "${{ secrets.FIREBASE_MEASUREMENT_ID }}"
          };
          
          // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‡Ñ‚Ğ¾ ĞºĞ»ÑÑ‡Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹
          if (!firebaseConfig.apiKey || firebaseConfig.apiKey.includes('secrets.FIREBASE')) {
              throw new Error('âŒ ĞĞ¨Ğ˜Ğ‘ĞšĞ: GitHub Secrets Ğ½Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹! ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒ Settings â†’ Secrets');
          }
          
          // Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ´Ğ»Ñ Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
          if (typeof window !== 'undefined') {
              window.firebaseConfig = firebaseConfig;
          }
          
          console.log('âœ… Firebase ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ°');
          console.log('ğŸ”¥ ĞŸÑ€Ğ¾ĞµĞºÑ‚: ${{ secrets.FIREBASE_PROJECT_ID }}');
          console.log('ğŸ” ĞšĞ»ÑÑ‡Ğ¸ Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½Ñ‹ GitHub Secrets');
          FIREBASE_EOF
          
          echo "âœ… firebase-config.js ÑĞ¾Ğ·Ğ´Ğ°Ğ½ Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸ Ğ¸Ğ· GitHub Secrets"
          wc -l _site/firebase-config.js

      - name: ğŸ“¦ Copy project files
        run: |
          cp -r index.html _site/ 2>/dev/null || true
          cp -r service-worker.js _site/ 2>/dev/null || true
          cp -r css/ _site/ 2>/dev/null || true
          cp -r js/ _site/ 2>/dev/null || true
          cp -r scripts/ _site/ 2>/dev/null || true
          
          echo "âœ… Ğ¤Ğ°Ğ¹Ğ»Ñ‹ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ğ² _site"
          ls -la _site/ | head -15

      - name: âœ… Verify files
        run: |
          echo "=== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ« ==="
          [ -f "_site/firebase-config.js" ] && echo "âœ… firebase-config.js ÑĞ¾Ğ·Ğ´Ğ°Ğ½" || echo "âŒ firebase-config.js ĞĞ• Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          [ -f "_site/index.html" ] && echo "âœ… index.html Ğ½Ğ°Ğ¹Ğ´ĞµĞ½" || echo "âŒ index.html ĞĞ• Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          
          echo ""
          echo "=== ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ FIREBASE CONFIG ==="
          grep -c "apiKey" _site/firebase-config.js && echo "âœ… apiKey Ğ¿Ğ¾Ğ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½" || echo "âŒ apiKey ĞĞ• Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"
          grep -c "projectId" _site/firebase-config.js && echo "âœ… projectId Ğ¿Ğ¾Ğ´ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½" || echo "âŒ projectId ĞĞ• Ğ½Ğ°Ğ¹Ğ´ĞµĞ½"

      - name: ğŸŒ Setup Pages
        uses: actions/configure-pages@v3
      
      - name: ğŸ“¤ Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: '_site'
          retention-days: 30

      - name: ğŸš€ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2

      - name: ğŸ“‹ Success Report
        run: |
          echo ""
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘           âœ… DEPLOYMENT Ğ£Ğ¡ĞŸĞ•Ğ¨Ğ•Ğ!                        â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "ğŸŒ Ğ¡Ğ°Ğ¹Ñ‚: https://askhat707.github.io/trading-data/"
          echo "ğŸ”¥ Firebase: trading-data-pro"
          echo ""
          echo "ğŸ” Ğ‘Ğ•Ğ—ĞĞŸĞĞ¡ĞĞĞ¡Ğ¢Ğ¬:"
          echo "  âœ… ĞšĞ»ÑÑ‡Ğ¸ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ¢ĞĞ›Ğ¬ĞšĞ Ğ² GitHub Secrets"
          echo "  âœ… ĞšĞ»ÑÑ‡Ğ¸ ĞĞ• Ğ²Ğ¸Ğ´Ğ½Ñ‹ Ğ² Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ¸"
          echo "  âœ… ĞšĞ»ÑÑ‡Ğ¸ ĞĞ• Ğ²Ğ¸Ğ´Ğ½Ñ‹ Ğ² Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸ ĞºĞ¾Ğ¼Ğ¼Ğ¸Ñ‚Ğ¾Ğ²"
          echo "  âœ… firebase-config.js Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸"
          echo "  âœ… Security Rules Ğ·Ğ°Ñ‰Ğ¸Ñ‰Ğ°ÑÑ‚ Ğ±Ğ°Ğ·Ñƒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…"
          echo ""
          echo "ğŸ“Š ĞŸĞ ĞĞ’Ğ˜Ğ›Ğ Ğ”ĞĞ¡Ğ¢Ğ£ĞŸĞ:"
          echo "  âœ… Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ"
          echo "  âœ… ĞĞ¸ĞºÑ‚Ğ¾ ĞºÑ€Ğ¾Ğ¼Ğµ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ° Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ"
          echo "  âœ… TRIAL Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ dte_0 Ğ¸ dte_1"
          echo "  âœ… PREMIUM Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ dte_2-9"
          echo ""
