name: üöÄ Deploy Trading Data Terminal

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v4

      - name: üü¢ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: üîß –°–æ–∑–¥–∞–Ω–∏–µ firebase-config.js –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤
        id: generate-config
        env:
          # –í–ê–ñ–ù–û: –í—Å–µ 8 —Å–µ–∫—Ä–µ—Ç–æ–≤ –î–û–õ–ñ–ù–´ –±—ã—Ç—å –∑–¥–µ—Å—å
          FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
          FIREBASE_AUTH_DOMAIN: ${{ secrets.FIREBASE_AUTH_DOMAIN }}
          FIREBASE_DATABASE_URL: ${{ secrets.FIREBASE_DATABASE_URL }}
          FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
          FIREBASE_STORAGE_BUCKET: ${{ secrets.FIREBASE_STORAGE_BUCKET }}
          FIREBASE_MESSAGING_SENDER_ID: ${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}
          FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}
          FIREBASE_MEASUREMENT_ID: ${{ secrets.FIREBASE_MEASUREMENT_ID }}
        run: |
          echo "üöÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è firebase-config.js..."
          
          # –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Å–µ–∫—Ä–µ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã (—Å–∫—Ä—ã–≤–∞—è –∑–Ω–∞—á–µ–Ω–∏—è)
          echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤:"
          echo "- FIREBASE_API_KEY: ${FIREBASE_API_KEY:0:10}..."
          echo "- FIREBASE_PROJECT_ID: $FIREBASE_PROJECT_ID"
          
          # –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∞—à —Å–∫—Ä–∏–ø—Ç
          node scripts/generate-config.js
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω
          if [ ! -f "firebase-config.js" ]; then
            echo "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: firebase-config.js –Ω–µ —Å–æ–∑–¥–∞–Ω!"
            echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ scripts/:"
            ls -la scripts/
            exit 1
          fi
          
          echo "‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω. –†–∞–∑–º–µ—Ä: $(wc -c < firebase-config.js) –±–∞–π—Ç"
          
          # –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ (–±–µ–∑ –ø–æ–∫–∞–∑–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤)
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞:"
          if grep -q "{{" firebase-config.js; then
            echo "‚ùå –í —Ñ–∞–π–ª–µ –æ—Å—Ç–∞–ª–∏—Å—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã {{}}!"
            exit 1
          else
            echo "‚úÖ –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –∑–∞–º–µ–Ω–µ–Ω—ã"
          fi

      - name: üìÑ –°–æ–∑–¥–∞–Ω–∏–µ .nojekyll
        run: touch .nojekyll

      - name: üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
        run: |
          echo "üìÅ –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ—Ä–Ω–µ:"
          ls -la | grep -E "(firebase|index|\.nojekyll)"
          echo ""
          echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º firebase-config.js:"
          if [ -f "firebase-config.js" ]; then
            echo "‚úÖ –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É
            echo "–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞: $(head -1 firebase-config.js)"
          else
            echo "‚ùå –§–∞–π–ª –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç!"
            exit 1
          fi

      - name: üì¶ –£–ø–∞–∫–æ–≤–∫–∞ –¥–ª—è GitHub Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: .
          retention-days: 1

      - name: üöÄ –î–µ–ø–ª–æ–π –Ω–∞ GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
