name: ðŸš€ Deploy Trading Data Terminal

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  deploy:
    runs-on: ubuntu-latest
    # Ð£Ð”ÐÐ›Ð˜Ð¢Ð• Ð¡Ð¢Ð ÐžÐšÐ£ environment - Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Repository secrets
    # environment:
    #   name: github-pages
    #   url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ðŸ” Validate Firebase Secrets
        run: |
          echo "ðŸ” ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Firebase Secrets..."
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Repository secrets
          echo "âœ… FIREBASE_API_KEY: ${#FIREBASE_API_KEY} ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"
          echo "âœ… FIREBASE_AUTH_DOMAIN: ${#FIREBASE_AUTH_DOMAIN} ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"
          echo "âœ… FIREBASE_DATABASE_URL: ${#FIREBASE_DATABASE_URL} ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"
          echo "âœ… FIREBASE_PROJECT_ID: ${#FIREBASE_PROJECT_ID} ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"
          echo "âœ… FIREBASE_STORAGE_BUCKET: ${#FIREBASE_STORAGE_BUCKET} ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"
          echo "âœ… FIREBASE_MESSAGING_SENDER_ID: ${#FIREBASE_MESSAGING_SENDER_ID} ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"
          echo "âœ… FIREBASE_APP_ID: ${#FIREBASE_APP_ID} ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"
          echo "âœ… FIREBASE_MEASUREMENT_ID: ${#FIREBASE_MEASUREMENT_ID} ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡Ñ‚Ð¾ Ð²ÑÐµ ÑÐµÐºÑ€ÐµÑ‚Ñ‹ Ð½Ðµ Ð¿ÑƒÑÑ‚Ñ‹Ðµ
          if [ -z "$FIREBASE_API_KEY" ]; then
            echo "âŒ FIREBASE_API_KEY: ÐŸÐ£Ð¡Ð¢ÐžÐ™"
            exit 1
          fi
          if [ -z "$FIREBASE_AUTH_DOMAIN" ]; then
            echo "âŒ FIREBASE_AUTH_DOMAIN: ÐŸÐ£Ð¡Ð¢ÐžÐ™"
            exit 1
          fi
          if [ -z "$FIREBASE_DATABASE_URL" ]; then
            echo "âŒ FIREBASE_DATABASE_URL: ÐŸÐ£Ð¡Ð¢ÐžÐ™"
            exit 1
          fi
          if [ -z "$FIREBASE_PROJECT_ID" ]; then
            echo "âŒ FIREBASE_PROJECT_ID: ÐŸÐ£Ð¡Ð¢ÐžÐ™"
            exit 1
          fi
          if [ -z "$FIREBASE_STORAGE_BUCKET" ]; then
            echo "âŒ FIREBASE_STORAGE_BUCKET: ÐŸÐ£Ð¡Ð¢ÐžÐ™"
            exit 1
          fi
          if [ -z "$FIREBASE_MESSAGING_SENDER_ID" ]; then
            echo "âŒ FIREBASE_MESSAGING_SENDER_ID: ÐŸÐ£Ð¡Ð¢ÐžÐ™"
            exit 1
          fi
          if [ -z "$FIREBASE_APP_ID" ]; then
            echo "âŒ FIREBASE_APP_ID: ÐŸÐ£Ð¡Ð¢ÐžÐ™"
            exit 1
          fi
          if [ -z "$FIREBASE_MEASUREMENT_ID" ]; then
            echo "âŒ FIREBASE_MEASUREMENT_ID: ÐŸÐ£Ð¡Ð¢ÐžÐ™"
            exit 1
          fi
          
          echo "âœ… Ð’Ð¡Ð• Ð¡Ð•ÐšÐ Ð•Ð¢Ð« ÐŸÐ Ð˜Ð¡Ð£Ð¢Ð¡Ð¢Ð’Ð£Ð®Ð¢ Ð˜ Ð—ÐÐŸÐžÐ›ÐÐ•ÐÐ«"

      - name: ðŸ”§ Generate Firebase Config
        run: |
          echo "ðŸ”§ Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ firebase-config.js..."
          
          # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Repository secrets
          cat > firebase-config.js << EOF
          // ====================================================
          // ðŸ”¥ FIREBASE CONFIG - GENERATED FROM GITHUB SECRETS
          // ====================================================
          
          console.log('ðŸš€ Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Firebase ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸...');
          
          const firebaseConfig = {
            apiKey: "${{ secrets.FIREBASE_API_KEY }}",
            authDomain: "${{ secrets.FIREBASE_AUTH_DOMAIN }}",
            databaseURL: "${{ secrets.FIREBASE_DATABASE_URL }}",
            projectId: "${{ secrets.FIREBASE_PROJECT_ID }}",
            storageBucket: "${{ secrets.FIREBASE_STORAGE_BUCKET }}",
            messagingSenderId: "${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}",
            appId: "${{ secrets.FIREBASE_APP_ID }}",
            measurementId: "${{ secrets.FIREBASE_MEASUREMENT_ID }}"
          };
          
          console.group('ðŸ“Š Firebase Configuration:');
          console.log('âœ… ÐŸÑ€Ð¾ÐµÐºÑ‚:', firebaseConfig.projectId);
          console.log('âœ… Auth Domain:', firebaseConfig.authDomain);
          console.log('âœ… Database:', firebaseConfig.databaseURL);
          console.groupEnd();
          
          window.firebaseConfig = firebaseConfig;
          console.log('âœ… ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð° Ð² window.firebaseConfig');
          
          if (typeof module !== 'undefined' && module.exports) {
            module.exports = firebaseConfig;
          }
          EOF
          
          echo "âœ… ÐšÐ¾Ð½Ñ„Ð¸Ð³ ÑÐ¾Ð·Ð´Ð°Ð½"
          echo "Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ firebase-config.js (Ð¿ÐµÑ€Ð²Ñ‹Ðµ 10 ÑÑ‚Ñ€Ð¾Ðº):"
          head -10 firebase-config.js

      - name: ðŸ“„ Create GitHub Pages Files
        run: |
          echo "ðŸ“„ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð²ÑÐ¿Ð¾Ð¼Ð¾Ð³Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²..."
          touch .nojekyll
          
          cat > robots.txt << 'EOF'
          User-agent: *
          Allow: /
          Sitemap: https://askhat707.github.io/trading-data/sitemap.xml
          EOF

      - name: ðŸ“ Verify Build Structure
        run: |
          echo "ðŸ“ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ñ„Ð°Ð¹Ð»Ð¾Ð²..."
          ls -la
          echo ""
          test -f "index.html" && echo "âœ… index.html" || echo "âŒ index.html"
          test -f "firebase-config.js" && echo "âœ… firebase-config.js" || echo "âŒ firebase-config.js"

      - name: ðŸ“¦ Upload Pages Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: .

      - name: ðŸš€ Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
