name: üöÄ Deploy Trading Data Terminal

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

env:
  NODE_VERSION: '18'

jobs:
  # ========================================================
  # 1. –°–ë–û–†–ö–ê –ò –ì–ï–ù–ï–†–ê–¶–ò–Ø –ö–û–ù–§–ò–ì–ê
  # ========================================================
  build:
    name: ‚öôÔ∏è Build & Generate Config
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v4

      - name: üü¢ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      # –ú–´ –ò–°–ü–û–õ–¨–ó–£–ï–ú –í–ê–® –°–ö–†–ò–ü–¢ NODE.JS - –≠–¢–û –ù–ê–î–ï–ñ–ù–ï–ï, –ß–ï–ú BASH
      - name: üîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è firebase-config.js
        env:
          FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
          FIREBASE_AUTH_DOMAIN: ${{ secrets.FIREBASE_AUTH_DOMAIN }}
          FIREBASE_DATABASE_URL: ${{ secrets.FIREBASE_DATABASE_URL }}
          FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
          FIREBASE_STORAGE_BUCKET: ${{ secrets.FIREBASE_STORAGE_BUCKET }}
          FIREBASE_MESSAGING_SENDER_ID: ${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}
          FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}
          FIREBASE_MEASUREMENT_ID: ${{ secrets.FIREBASE_MEASUREMENT_ID }}
        run: |
          echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏..."
          
          # –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∞—à —Å–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–æ–Ω –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã)
          node scripts/generate-config.js
          
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
          if [ -f "firebase-config.js" ]; then
            echo "‚úÖ –§–∞–π–ª firebase-config.js —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!"
          else
            echo "‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: –§–∞–π–ª –Ω–µ —Å–æ–∑–¥–∞–Ω!"
            exit 1
          fi

      - name: üìÑ –°–æ–∑–¥–∞–Ω–∏–µ .nojekyll (–¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –ø—É—Ç–µ–π)
        run: touch .nojekyll

      # –°–ê–ú–´–ô –í–ê–ñ–ù–´–ô –®–ê–ì: –£–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –í–°–ï —Ñ–∞–π–ª—ã (–≤–∫–ª—é—á–∞—è —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥) –≤ –∞—Ä—Ö–∏–≤ –¥–ª—è –¥–µ–ø–ª–æ—è
      # –≠—Ç–æ –∑–∞–º–µ–Ω—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å "–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å" –∫–æ–Ω—Ñ–∏–≥ –≤–æ –≤—Ç–æ—Ä–æ–º —à–∞–≥–µ
      - name: üì¶ –£–ø–∞–∫–æ–≤–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞
        uses: actions/upload-pages-artifact@v3
        with:
          path: .

  # ========================================================
  # 2. –î–ï–ü–õ–û–ô (–ë–µ—Ä–µ—Ç –≥–æ—Ç–æ–≤—ã–π –∞—Ä—Ö–∏–≤ –∏–∑ —à–∞–≥–∞ 1)
  # ========================================================
  deploy:
    name: üöÄ –î–µ–ø–ª–æ–π –Ω–∞ GitHub Pages
    runs-on: ubuntu-latest
    needs: build # –ñ–¥–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–±–æ—Ä–∫–∏
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: üöÄ –î–µ–ø–ª–æ–π –Ω–∞ GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
